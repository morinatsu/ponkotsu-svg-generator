### Julesへの指示書 (v0.6 - テキストツール追加)

### **プロジェクト名:**

ぽんこつSVGジェネレーター (v0.6 - テキストツール追加)

### **プロジェクト概要:**

これまでの図形描画機能に加え、新たに**テキストをSVGキャンバス上に追加・編集できる機能**を実装します。ユーザーがキャンバスをクリックした位置にテキスト入力用のモーダルを表示し、入力された内容をSVGの`<text>`および`<tspan>`要素として描画します。

---

### **機能要件:**

#### 1. UIの変更
* **ツールバーの更新:**
    * 既存の図形選択ツールに**「テキスト」**ボタンを追加してください。
* **テキスト入力UI:**
    * テキストツールが選択された状態でキャンバスをクリック、または既存のテキスト図形をダブルクリックすると、**テキスト入力用のモーダルダイアログ**が表示されるようにしてください。
    * このモーダルには、複数行の入力が可能な`<textarea>`と、「OK」「キャンセル」ボタンを設置してください。

#### 2. データ構造と状態管理の拡張
* **`ShapeData` 型の拡張:**
    * `ShapeData` のUnion型に、新しく `TextData` 型を追加してください。以下のプロパティを含めることを推奨します。
        * `type: 'text'`
        * `content: string` （改行を含むテキスト全体）
        * `x: number`, `y: number` （テキストの開始座標）
        * `fontSize: number`
        * `fill: string` （文字色）
* **`AppState` の拡張:**
    * テキスト入力モーダルの状態を管理するためのプロパティを追加してください。（例: `editingText: { id: string | null, content: string } | null`）

#### 3. コア機能
* **テキストの新規作成:**
    * テキストツールでキャンバスをクリックすると、モーダルが開きます。
    * 「OK」をクリックすると、入力内容が`AppState`に追加され、キャンバス上にSVGテキストとして描画されます。
* **テキストの編集:**
    * キャンバス上のテキスト図形を**ダブルクリック**すると、その内容が入力された状態でモーダルが開きます。
    * 「OK」をクリックすると、該当するテキスト図形の`content`が更新されます。
* **テキストの描画:**
    * `content`プロパティ内の改行文字 (`\n`) を基準に、各行を`<tspan>`要素として描画し、複数行テキストを表現してください。
* **テキストの削除:**
    * **特別な実装は不要です。** テキスト図形は他の図形と同様にクリックで選択可能です。選択状態で`Delete`キーまたは`Backspace`キーを押すと、既存の`DELETE_SELECTED_SHAPE`アクションが処理され、図形が削除されます。

---

### **実装ステップの提案:**

Jules、以下のステップで実装を進めてください。

1.  **Stateと型の定義変更 (`src/state/reducer.ts`):**
    * `ShapeData` に `TextData` 型を追加します。
    * `AppState` に `editingText` プロパティを追加します。
    * `Action` 型に `START_TEXT_EDIT`, `UPDATE_TEXT_CONTENT`, `FINISH_TEXT_EDIT` のような新しいアクションを追加します。

2.  **Reducerのロジック拡張 (`src/state/reducer.ts`):**
    * 追加したテキスト関連アクションを処理する`case`文を実装してください。`FINISH_TEXT_EDIT`では、IDの有無によって新規作成か既存の更新かを判断し、`shapes`配列を更新します。

3.  **テキスト入力モーダルコンポーネントの作成 (`src/components/TextInputModal.tsx`):**
    * 画面全体を覆うオーバーレイと、中央に表示されるダイアログを持つコンポーネントを新規に作成します。
    * `textarea`とボタンを持ち、Propsとして現在のテキスト内容と、OK/キャンセル時のコールバック関数を受け取ります。

4.  **`App.tsx` でのモーダル連携:**
    * `state.editingText` の状態に応じて、`TextInputModal`を条件付きでレンダリングします。
    * キャンバスのクリックイベントハンドラを修正し、`currentTool`が`'text'`の場合は`START_TEXT_EDIT`アクションをdispatchしてモーダルを開くようにします。
    * テキスト図形に`onDoubleClick`イベントハンドラを追加し、同様に`START_TEXT_EDIT`アクションを（既存のIDと内容と共に）dispatchするようにします。

5.  **テキスト描画処理の実装 (`Shape.tsx`):**
    * `switch`文に`case 'text'`を追加します。
    * `shape.content.split('\n')`で文字列を行ごとに分割し、`.map()`で各行を`<tspan>`要素としてレンダリングします。
    * 各`<tspan>`には、`x`座標と、行ごとにインクリメントする`dy`属性（行間）を設定してください。
    * テキスト全体のスタイル（`fontSize`, `fill`など）は親の`<text>`要素に設定します。