# 追加のリファクタリング・改善提案

`AGENTS.md` の規約や、コードベース全体の設計・可読性の観点から、以下の追加改善点を提案します。

---

### 1. プロジェクト規約 (`AGENTS.md`) との乖離・改善点

開発体験とコード品質の一貫性を高めるため、`AGENTS.md`で示されている開発標準との乖離を修正します。

- **Node.jsバージョンの固定**:
  - **指摘**: `.nvmrc` ファイルが存在しません。
  - **提案**: `nvm use` で利用するNode.jsのバージョンを記した `.nvmrc` ファイルをプロジェクトルートに追加します。

- **開発コマンドの拡充**:
  - **指摘**: `package.json` の `scripts` に `format` と `typecheck` がありません。また、`lint` スクリプトに自動修正オプション (`--fix`) がありません。
  - **提案**:
    - `prettier` を開発依存関係に追加し、`"format": "prettier --write ."` スクリプトを追加する。
    - `"lint": "eslint . --fix"` のように `--fix` オプションを追加する。
    - `"typecheck": "tsc --noEmit"` スクリプトを追加する。

- **コミット前フックの導入**:
  - **指摘**: `husky` と `lint-staged` が導入されておらず、コミット時の自動チェックが行われていません。
  - **提案**: `husky` と `lint-staged` を設定し、コミット時に `prettier` と `eslint` が自動で実行されるように構成します。

---

### 2. 設計・アーキテクチャに関する提案

中長期的な保守性・拡張性を高めるためのアーキテクチャレベルの提案です。

- **Props Drilling（プロパティのバケツリレー）の緩和**:
  - **指摘**: `App` → `SvgCanvas` → `Shape` へと、多くのプロパティが複数のコンポーネント層をまたいで手渡されています。
  - **提案**: **React Context** を導入し、`dispatch` 関数や `selectedShapeId` などを必要なコンポーネントから直接参照できるようにします。これにより、中間のコンポーネントが props を受け渡す責務から解放されます。

- **巨大なReducerの分割**:
  - **指摘**: `reducer.ts` の `reducer` 関数が、多数のロジックを抱えて肥大化しています。
  - **提案**: Reducerを機能単位で分割します（例: `drawingReducer`, `draggingReducer`, `shapesReducer`）。これらをルートで結合することで、各ファイルの責務が明確になり、可読性とテストのしやすさが向上します。

---

### 3. コードの可読性と整理

よりクリーンで理解しやすいコードベースにするための提案です。

- **型定義の分離**:
  - **指摘**: `AppState`, `Action`, `ShapeData` といった重要な型定義が、すべて `reducer.ts` 内にあります。
  - **提案**: `src/types.ts` のような専用ファイルを作成し、プロジェクト全体で使われる型定義をそこに集約します。

- **コンポーネントの分割**:
  - **指摘**: `SvgCanvas.tsx` 内で `DrawingPreview` コンポーネントが定義されています。
  - **提案**: `DrawingPreview` を `src/components/DrawingPreview.tsx` として独立したファイルに切り出します。

- **`useRef` の意図をコメントで補足**:
  - **指摘**: `App.tsx` の `wasDragged` のように、再描画を避ける目的で `useRef` が使われていますが、その意図がコードから直感的に分かりにくい場合があります。
  - **提案**: `// 再描画を避けるためrefで管理` のような短いコメントを添えることで、コードの意図を明確にします。
